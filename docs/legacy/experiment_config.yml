version: 1

scenario:
  name: exp_mp
  description: "Monday multiplier + prime gate"

pipeline:
  steps:
    - name: parse_load_attempt
    - name: compute_time_keys
    - name: idempotency_gate
    - name: compute_features
    - name: evaluate_policies
    - name: update_windows
    - name: format_output
    - name: write_output

features:
  enabled: true
  monday_multiplier:
    enabled: true
    multiplier: 2.0
    apply_to: amount
  prime_gate:
    enabled: true
    global_per_day: 1
    amount_cap: 9999.00

policies:
  pack: exp_mp
  evaluation_order:
    - daily_attempt_limit
    - prime_global_gate
    - daily_amount_limit
    - weekly_amount_limit
  limits:
    daily_amount: 5000.00
    weekly_amount: 20000.00
    daily_attempts: 3
  prime_gate:
    enabled: true
    global_per_day: 1
    amount_cap: 9999.00

windows:
  daily_attempts:
    enabled: true
  daily_accepted_amount:
    enabled: true
  weekly_accepted_amount:
    enabled: true
  daily_prime_gate:
    enabled: true

output:
  file: output.txt

tracing:
  enabled: false
  signature:
    mode: type_only
  context_diff:
    mode: whitelist
    whitelist:
      - line_no
      - tags
      - metrics
      - errors
  sink:
    kind: jsonl
    jsonl:
      path: trace.jsonl
      write_mode: line
      flush_every_n: 1
      fsync_every_n: null
